<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>Home</title>
    <link rel="stylesheet" href="./home.css">
    <!-- 一旦保留 <script src="./home.js"></script> -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="https://wataru532.github.io/Scheduler/artworks/apple-touch-icon-180x180.png">
</head>
<body>
    <section class="headsection">
        <a href="index.html"><img class="home-img1" src="artworks/apple-touch-icon-180x180.png"></a>
        <p1>Scheduler - Home</p1>
        <div align="right">
            <a href="./login.html" class="login_button">Account</a>
        </div>
        
    
        <div align="left">
            <a href="./home.html" class="home">Home</a>
            <a href="./assignments.html" class="assignments">Assignments</a>
            <a href="./classes.html" class="classes">Classes</a>
            <a href="./notifications.html" class="notifications">Notifications</a>
            <a href="https://mail.google.com/chat/u/0/#chat/home" class="chats" target="_blank" rel="noopener noreferrer">Chats</a>
        </div>
        <hr class="line1">
    </section>
    <p2>Class : <span id="classroomname"></span></p2><br>
    <p3>Today : <span id="text"></span></p3><br>
    <table align="center" border=1>
        <thead>
            <tr>
                <th>  </th>
                <th id="monday">Mon</th>
                <th id="tueday">Tue</th>
                <th id="wedday">Wed</th>
                <th id="thuday">Thu</th>
                <th id="friday">Fri</th>
            </tr>
            <tr>
                <th id="month_now"></th><th id="d_Mon"></th><th id="d_Tue"></th>
                <th id="d_Wed"></th><th id="d_Thu"></th><th id="d_Fri"></th>
            </tr>
        </thead>
        <tbody>
            <!-- 将来的に<a>タグでリンク飛べるようにする -->
            <tr><td class="tn">1</td><td class="htdata" id="0"></td><td class="htdata" id="6"></td><td class="htdata" id="12"></td><td class="htdata" id="18"></td><td class="htdata" id="24"></td></tr>
            <tr><td class="tn">2</td><td class="htdata" id="1"></td><td class="htdata" id="7"></td><td class="htdata" id="13"></td><td class="htdata" id="19"></td><td class="htdata" id="25"></td></tr>
            <tr><td class="tn">3</td><td class="htdata" id="2"></td><td class="htdata" id="8"></td><td class="htdata" id="14"></td><td class="htdata" id="20"></td><td class="htdata" id="26"></td></tr>
            <tr><td class="tn">4</td><td class="htdata" id="3"></td><td class="htdata" id="9"></td><td class="htdata" id="15"></td><td class="htdata" id="21"></td><td class="htdata" id="27"></td></tr>
            <tr><td class="tn">5</td><td class="htdata" id="4"></td><td class="htdata" id="10"></td><td class="htdata" id="16"></td><td class="htdata" id="22"></td><td class="htdata" id="28"></td></tr>
            <tr><td class="tn">6</td><td class="htdata" id="5"></td><td class="htdata" id="11"></td><td class="htdata" id="17"></td><td class="htdata" id="23"></td><td class="htdata" id="29"></td></tr>
        </tbody>
    </table><br>
    
    <footer>
        <div align="right"><button class="circle-button">?</button></div>
        <div class="menu" id="menu">
            <ul>
                <a href="https://forms.gle/9ExuRPUDyRMcMxxp8" style="text-decoration: none; color: inherit;" target="_blank" rel="noopener noreferrer"><li>フィードバックを送信</li></a>
                <li>使い方</li>
                <a href="https://wataru532.github.io/Scheduler" style="text-decoration: none; color: inherit;" target="_blank" rel="noopener noreferrer"><li>About Scheduler</li></a>
                <a href="https://wataru532.github.io/Scheduler/updatelog.html" style="text-decoration: none; color: inherit;" target="_blank" rel="noopener noreferrer">
                    <li>Update Log</li>
                </a>
            </ul>
        </div>
        <div align="right">v0.0.1</div>
    </footer>
    
    <script>
        //ヘルプボタン
        document.addEventListener("DOMContentLoaded", function() {
            const button = document.querySelector(".circle-button");
            const menu = document.getElementById("menu");

            button.addEventListener("click", function(event) {
                // メニューの表示位置を設定
                const rect = button.getBoundingClientRect();
                menu.style.top = `${rect.top + window.scrollY}px`;
                menu.style.left = `${rect.right + window.scrollX}px`;
                
                // メニューの表示をトグル
                if (menu.style.display === "block") {
                    menu.style.display = "none";
                } else {
                    menu.style.display = "block";
                }
            });

            // メニューの外側をクリックしたときにメニューを非表示にする
            document.addEventListener("click", function(event) {
                if (!button.contains(event.target) && !menu.contains(event.target)) {
                    menu.style.display = "none";
                }
            });
        });

        //使用するグローバル変数の定義
        const now = new Date();
        const year = now.getYear();
        const month = now.getMonth();
        const date = now.getDate();
        const day = now.getDay();
        const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
        const weeks = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
        var a = 0;
        var b = 0;
        const subj = {
            " 芸": [" 音楽"," 美術"," 書道"],
            " 日地": [" 日史"," 地理"],
            " 物生": [" 物理"," 生物"],
            " 理物生": [" 理物"," 理生"],
            " 地歴β": [" 地理β"," 歴史β"],
            " 世政経": [" 世史"," 政治"," 経済"]

        }
        const classroom_name = [
                            "3-1","3-2","3-3","3-4","3年理探","3年国探",
                            "2-1","2-2","2-3","2-4","2年理探","2年国探",
                            "1-1","1-2","1-3","1-4","1-5","1-6"
                        ]

        const subj_col_class = {
            " 現国":"td_ja", " 言語文":"td_ja", " 論理国":"td_ja", " 漢文":"td_ja", " 古文":"td_ja", " 古漢":"td_ja", " 古典":"td_ja", //国語
            " 実数A":"td_math", " 実数B":"td_math", " 応数":"td_math", " 理数Ⅱ":"td_math"," 理数E":"td_math"," 数Ⅱ":"td_math"," 数ＢC":"td_math", //数学
            " 数ⅡⅢ":"td_math"," 理数Ⅱ":"td_math", " 理数Ⅱβ":"td_math"," 数ⅠⅡ":"td_math"," 数Ａ":"td_math", " 理数Ⅰ":"td_math",
            " CⅢ":"td_en"," 総英Ⅲ":"td_en"," 総英Ⅱ":"td_en"," 総英Ⅰ":"td_en"," ECⅡ":"td_en"," ECⅠ":"td_en", //英語
            " EWⅡ":"td_en"," EWⅠ":"td_en"," 論表Ⅲ":"td_en"," 論表Ⅱ":"td_en"," 論表Ⅰ":"td_en", 
            " 歴史":"td_soci"," 地理":"td_soci"," 世史":"td_soci"," 日史":"td_soci"," 政治":"td_soci"," 経済":"td_soci", " 歴史β":"td_soci"," 地理β":"td_soci"," 公共":"td_soci", //社会
            " 物理":"td_sci", " 物基":"td_sci", " 理物":"td_sci", " 生物":"td_sci", " 生基":"td_sci", " 理生":"td_sci", " 化":"td_sci", " 化基":"td_sci", " 理化":"td_sci", " 自β":"td_sci",//理科
            " 家":"td_homE", " 情報Ⅰ":"td_info", " 保":"td_pe", " 体":"td_pe", " 音楽":"td_art", " 美術":"td_art", " 書道":"td_art", " ":"td_none"//その他
        }
        
        //ウィンドウサイズの処理
        var wratio;
        if (window.innerHeight / window.innerWidth >= 1.2) {wratio = 1}
        else {wratio = 0}
        
        //うるう年の処理
        if (year%4==0 && !(year%100==0 && year%400!=0)) {
            var dates = [31,29,31,30,31,30,31,31,30,31,30,31];
        } else{
            var dates = [31,28,31,30,31,30,31,31,30,31,30,31];
        }

        document.getElementById("text").innerHTML = showDay();
        document.getElementById("d_Mon").innerHTML = showd_Mon();
        document.getElementById("d_Tue").innerHTML = showd_Tue();
        document.getElementById("d_Wed").innerHTML = showd_Wed();
        document.getElementById("d_Thu").innerHTML = showd_Thu();
        document.getElementById("d_Fri").innerHTML = showd_Fri();
        document.getElementById("month_now").innerHTML = month_Now();
  
        function showDay() {
            return weeks[day] + " " + months[month] + "/" + date + " " + now.getFullYear();
        }

        //以下日付処理
        function showd_Mon(){
            document.getElementById("d_Mon").className = "not_today";
            if (date-day+1 > dates[month]){
                a = date-day+1 - dates[month];
            } else if (date-day+1 <= 0){
                a = dates[month-1] + date-day+1;
            }else{
                a = date - day + 1;
            }
            
            return a;
        }

        function showd_Tue(){
            document.getElementById("d_Tue").className = "not_today";
            if (date-day+2 > dates[month]){
                return date-day+2-dates[month];
            }else if (date-day+2 <= 0){
                return dates[month-1] + date-day+2;
            } else{
                return date - day + 2;
            }
        }

        function showd_Wed(){
            document.getElementById("d_Wed").className = "not_today";
            if (date-day+3 > dates[month]){
                return date-day+3-dates[month];
            }else if (date-day+3 <= 0){
                return dates[month-1] + date-day+3;
            } else{
                return date - day + 3;
            }
        }

        function showd_Thu(){
            document.getElementById("d_Thu").className = "not_today";
            if (date-day+4 > dates[month]){
                return date-day+4-dates[month];
            }else if (date-day+4 <= 0){
                return dates[month-1] + date-day+4;
            } else{
                return date - day + 4;
            }
        }

        function showd_Fri(){
            document.getElementById("d_Fri").className = "not_today";
            if (date-day+5 > dates[month]){
                b = date-day+5-dates[month];
            } else if (date-day+5 <= 0){
                b =  dates[month-1] + date-day+5;
            }else{
                b =  date - day + 5;
            }
            return b;
        }

        function month_Now(){
            if(date < 10 && a > b){
                var c = months[month-1];
                var d = months[month];
            }
            else if(date > 10 && a > b){
                var c = months[month];
                var d = months[month+1];
            }
            else{
                var c = months[month];
                var d = "none";
            }

            if (d == "none"){
                return c;
            }else{
                return c + " / " + d;
            }
        }

        //強調構文
        function emphasize(){
            document.getElementById("monday").className = "not_today";
            document.getElementById("tueday").className = "not_today";
            document.getElementById("wedday").className = "not_today";
            document.getElementById("thuday").className = "not_today";
            document.getElementById("friday").className = "not_today";
            
            if(day == 1){
                document.getElementById("monday").className = "today";
                document.getElementById("d_Mon").className = "today";
                
            } else if (day == 2){
                document.getElementById("tueday").className = "today";
                document.getElementById("d_Tue").className = "today";

            } else if (day == 3){
                document.getElementById("wedday").className = "today";
                document.getElementById("d_Wed").className = "today";
                
            } else if (day == 4){
                document.getElementById("thuday").className = "today";
                document.getElementById("d_Thu").className = "today";
                
            } else if (day == 5){
                document.getElementById("friday").className = "today";
                document.getElementById("d_Fri").className = "today";
            }
        }

        function view_data(){ //データの表示
            var jsonData;
            var classData;
            var selectionData;
            //選択科目のデータを取得するプログラムを記述
            //以下は仮のデータ
            selectionData = {
                "class":"12", //12 as 2年理探
                "subjects":{" 芸":" 音楽", " 理物生":" 理物", " 日地":" 地理"}
            }

            document.getElementById("classroomname").innerHTML = classroom_name[selectionData["class"]-2];

            //json data
            fetch('https://Wataru532.github.io/Scheduler/data/schedule_data.json')
            .then(function(response) {
              if (!response.ok) {
                throw new Error('Failed to load JSON file: ' + response.statusText);
              }
              return response.json();
            })
            .then(function(data) {
              jsonData = data;
              console.log(jsonData);
              classData = jsonData[selectionData["class"]]["null"]; 
              console.log(classData);

              for (let i = 0; i < 30; i++){ //選択教科表示、背景色変更
                let d = classData[i]
                if (d == " 芸" || d == " 物生" || d == " 理物生" || d == " 日地" || d == " 地歴β" || d == " 世政経"){ //選択科目用
                    classData[i] = selectionData["subjects"][d];
                }
                d = classData[i] //更新しなきゃいけないの忘れてた
                document.getElementById(String(i)).innerHTML = d; //データセット
                let targetid = document.getElementById(String(i));
                if (targetid){                                    //背景色変更用
                    targetid.className = subj_col_class[d];
                }
              }
            })
            .catch(function(error) {
              console.error('Error fetching JSON file: ', error);
            });
        };
    
        window.onresize = function () { //ウィンドウサイズ更新検知
            if (window.innerHeight / window.innerWidth >= 1.2) {wratio = 1}
            else {wratio = 0}
        };

        showDay();
        showd_Mon();
        showd_Tue();
        showd_Wed();
        showd_Thu();
        showd_Fri();
        month_Now();
        emphasize();
        view_data();
        
    </script>
</body>